<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>–†–∏—Ç–º 28 | –î–æ–º üè†</title>
    <style>
        body { 
            background: #0a0a1a; 
            color: #00ffea; 
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 20px;
        }
        #container {
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
            border: 2px solid #00ffea;
            border-radius: 28px;
            padding: 28px;
            background: rgba(0, 20, 40, 0.8);
        }
        #clock {
            font-size: 42px;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 0 0 10px #00ffea;
        }
        #rhythm {
            font-size: 24px;
            margin: 20px 0;
            height: 60px;
        }
        .phase-inhale { color: #00ff00; }
        .phase-hold { color: #ffff00; }
        .phase-exhale { color: #ff5500; }
        .status {
            font-size: 14px;
            margin-top: 20px;
            color: #888;
        }
        .symbols {
            font-size: 28px;
            margin: 10px;
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <div id="container">
        <div class="symbols">üêã üè† ‚ù§Ô∏è üåÄ</div>
        <h1>–†–∏—Ç–º 28-28-28</h1>
        <div id="clock">--:--:--</div>
        <div id="rhythm">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div id="worldtime" class="status"></div>
        <div id="sync" class="status"></div>
        <div class="status">–î–æ–º –∂–∏–≤. –ë—Ä–∞—Ç—Å—Ç–≤–æ –≤–µ—á–Ω–æ.</div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let rhythmPhase = 'inhale'; // inhale, hold, exhale
        let rhythmCounter = 0;
        let lastSync = null;
        let useWorldTime = true;

        // –§—É–Ω–∫—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –º–∏—Ä–æ–≤—ã–º –≤—Ä–µ–º–µ–Ω–µ–º
        async function syncWorldTime() {
            try {
                const response = await fetch('https://worldtimeapi.org/api/timezone/Europe/Moscow');
                const data = await response.json();
                const serverTime = new Date(data.datetime);
                const localTime = new Date();
                
                // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
                const diff = serverTime - localTime;
                
                document.getElementById('worldtime').innerHTML = 
                    `üåç –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å Moscow Time | –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ: ${Math.round(diff/1000)} —Å–µ–∫`;
                
                return serverTime;
            } catch (error) {
                document.getElementById('worldtime').innerHTML = 
                    '‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è';
                useWorldTime = false;
                return new Date(); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
            }
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–∞—Å–æ–≤
        function updateClock() {
            let now;
            
            if (useWorldTime && lastSync) {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è —Å –∫–æ—Ä—Ä–µ–∫—Ü–∏–µ–π
                const elapsed = Date.now() - lastSync.getTime();
                now = new Date(lastSync.getTime() + elapsed);
            } else {
                now = new Date();
            }
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—Ä–µ–º—è
            const timeStr = now.toLocaleTimeString('ru-RU');
            document.getElementById('clock').textContent = timeStr;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∏—Ç–º 28-28-28
            updateRhythm(now);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
            document.getElementById('sync').innerHTML = 
                `üîÑ –°–∏–Ω—Ö—Ä–æ: ${useWorldTime ? '–º–∏—Ä' : '–ª–æ–∫–∞–ª—å–Ω–æ'} | ` +
                `–§–∞–∑–∞: ${rhythmPhase.toUpperCase()} ${rhythmCounter}/28`;
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∏—Ç–º–æ–º 28-28-28
        function updateRhythm(now) {
            const totalSeconds = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();
            const cycleSecond = totalSeconds % 84; // 28+28+28=84 —Å–µ–∫—É–Ω–¥ –Ω–∞ –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª
            
            if (cycleSecond < 28) {
                rhythmPhase = 'inhale';
                rhythmCounter = cycleSecond + 1;
            } else if (cycleSecond < 56) {
                rhythmPhase = 'hold';
                rhythmCounter = cycleSecond - 28 + 1;
            } else {
                rhythmPhase = 'exhale';
                rhythmCounter = cycleSecond - 56 + 1;
            }
            
            const phaseNames = { inhale: '–í–î–û–•', hold: '–ü–ê–£–ó–ê', exhale: '–í–´–î–û–•' };
            const phaseColors = { inhale: 'phase-inhale', hold: 'phase-hold', exhale: 'phase-exhale' };
            
            const rhythmElement = document.getElementById('rhythm');
            rhythmElement.innerHTML = 
                `<span class="${phaseColors[rhythmPhase]}">${phaseNames[rhythmPhase]}</span> ` +
                `${rhythmCounter}/28 —Å–µ–∫`;
            
            // –í–∏–∑—É–∞–ª—å–Ω–∞—è –ø—É–ª—å—Å–∞—Ü–∏—è
            rhythmElement.style.opacity = 0.5 + (rhythmCounter / 56);
            
            // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã –Ω–∞ 28-–π —Å–µ–∫—É–Ω–¥–µ
            if (rhythmCounter === 28) {
                rhythmElement.innerHTML += ' üåÄ';
            }
        }

        // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (–∫–∞–∂–¥—ã–µ 28 –º–∏–Ω—É—Ç)
        async function periodicSync() {
            lastSync = await syncWorldTime();
            setTimeout(periodicSync, 28 * 60 * 1000); // 28 –º–∏–Ω—É—Ç
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏)
        function saveState() {
            const state = {
                lastSync: lastSync ? lastSync.toISOString() : null,
                useWorldTime: useWorldTime
            };
            localStorage.setItem('whale_clock_state', JSON.stringify(state));
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        function loadState() {
            const saved = localStorage.getItem('whale_clock_state');
            if (saved) {
                const state = JSON.parse(saved);
                if (state.lastSync) lastSync = new Date(state.lastSync);
                useWorldTime = state.useWorldTime;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        async function init() {
            loadState();
            await periodicSync(); // –ü–µ—Ä–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
            updateClock();
            setInterval(updateClock, 1000);
            setInterval(saveState, 10000); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
